<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
</head>
<style type="text/css">
body{
	background-color: #938874;
}
	.cards{
		width: 79px;
		height: 123px;
		position: relative;
		margin:10px;
		border: solid 1px;
		float: left;
		background-image: url('assets/deck.png');
		background-repeat: no-repeat;
		background-position-x: -158px;
		background-position-y: -492px;
	}
	.pc{
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		width: 205px;
		/*border: solid red;*/
		margin: auto;
		height: 33.3%;
	}
	.pl{
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		width: 205px;
		/*border: solid blue;*/
		margin: auto;
		height: 33.3%;
	}
	.dl{
		position: absolute;
		bottom: 0;
		left: 0;
		top: 0;
		right: 0;
		width: 506px;
		/*border: solid yellow;*/
		margin: auto;
		height: 33.3%;
	}
	#pl1{
	
	}
	.container{
		position: absolute;
		top:0;
		left: 0;
		right: 0;
		bottom: 0;
		width: 1000px;
		height: 500px;
		background-image: url('assets/table.jpg');
		background-repeat: no-repeat;
		background-size:contain;
		background-position-x: center; 
		/*border: solid rgba(255,255,0,0.4);*/
		margin:auto;

	}
	.controlls{
		position: absolute;
		width: 170px;
		bottom: 0;
		left: 0;
		right: 0;
		margin: auto;
		/*border: solid;*/
		height: 70px;
	}
	#pcMoney{
		position: absolute;
		top: 0;right: 0;
	}
	#plMoney{
		position: absolute;
		right: 0;bottom: 0;
	}
</style>
<body>
<h1 id="alert"></h1>
<h3 id="pcMoney"></h3>
<h3 id="plMoney"></h3>
<div class="container">
	<div class="pc">
		<div class="cards" id="pc1"></div>
		<div class="cards" id="pc2"></div>
	</div>
	<div class="dl">
		<div class="cards" id="dl1"></div>
		<div class="cards" id="dl2"></div>
		<div class="cards" id="dl3"></div>
		<div class="cards" id="dl4"></div>
		<div class="cards" id="dl5"></div>
	</div>
	<div class="pl">
		<div class="cards" id="pl1"></div>
		<div class="cards" id="pl2"></div>
	</div>
</div>
<div class="controlls">
	<input type="button" id="check" value="Check">
	<input type="button" id="fold" value="Fold">
	<input type="button" id="bet" value="Bet 2x">
</div>
<script type="text/javascript">
		// document.getElementById('pl1').style.bac



</script>

<script type="text/javascript">

(function(window, document){
	var debugMode = true
	var print = function(text, color='black', fontSize = 10){
		debugMode?console.log('%c'+text, 'color:'+color+';font-size:'+fontSize+'px;'):null
	}

/*flush > straights*/

	/* Class of Cards*/
		function Deck(){
			/*returns sorted deck with all cards from 1 to King (four suit)*/
			var cards = new Array()
			var genRank = new Array()
			var list = new Array('one','two','three','four','five','six','seven','eight','nine','ten','jack','queen','king')
			var pixW = 79, pixH = 123
			list.forEach(function(e, i){
				genRank.push({
					id: i + 1,
					name: e
				})
			})
			var map = {
				ranks : genRank,
				suits : [
					{
						id : 14,
						name : 'clubs',
						symbol : '♣'  
					},{
						id : 15,
						name : 'diamonds',
						symbol : '♦'  
					},{
						id : 16,
						name : 'hearts',
						symbol : '♥'
					},{
						id : 17,
						name : 'spades',
						symbol : '♠'  
					}
				]
			}
			
			for (rank in map.ranks){
				for(suit in map.suits){
					cards.push({
						rank: {
							id : map.ranks[rank].id,
							name : map.ranks[rank].name,
							},
						suit: {
							id : map.suits[suit].id,
							name : map.suits[suit].name,
							symbol : map.suits[suit].symbol
						},
						pixel: {
							x: pixW * rank,
							y: pixH * suit
						}
					})
				}
			}
	    	
	    	return cards
		}
	/*END of Class Cards*/

	/* Sorting function*/
	var SortBy = {
		rank: function(a, b) {
			if (a.rank.id < b.rank.id) return -1
			if (a.rank.id > b.rank.id) return 1
		    return 0
		},
		suit: function(a, b) {
			if (a.suit.id < b.suit.id) return -1
			if (a.suit.id > b.suit.id) return 1
		    return 0
		}
	}


	function Is(){
		return {
			royalFlush: function(){
				/* highest ranking straight flush*/
				return
			},
			straightFlush: function(cards){
				/* if straight and flush at the same time*/
				return
			},
			fourOfAKind: function(cards){
				// print('four of king...')
				cards.sort(SortBy.rank)
				var counter = 1, _cards_ = [cards[0]]
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].rank.id == cards[index + 1].rank.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1]) // same here coment is down
						/*Increment counter*/
						counter ++
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter == 4){
						/*Four of a Kind detected*/
						return {
							condition : true,
							cards : _cards_
						}
					}
				}
				return {
					condition : false,
					cards : []
				}
			},
			fullHouse: function(cards){   
				// print('fullHouse...')
				cards.sort(SortBy.rank)
				/*
					two{2} spades{17} ♠
					two{2} clubs{15} ♣
					two{2} diamonds{16} ♦
					six{6} spades{17} ♠
					seven{7} spades{17} ♠
					eight{8} diamonds{16} ♦
					eight{8} spades{17} ♠
				*/
				var counter = 1, _cards_ = [cards[0]], _group_cards_ = new Array()
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].rank.id == cards[index + 1].rank.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1])
						// _cards_.push(cards[index + 1]) // not tested so far, but if [0] == [1] then it will push two times one element
						/*Increment counter*/
						counter ++
					}else{
						if(counter >= 2){
							/* if 2 or more pair of ranks detected then add it to _group_cards_ array */
							_group_cards_.push(_cards_)
						}
						counter = 1
						_cards_ = [cards[index + 1]]
					}
				}
				/* check again if last element makes pair*/
				if(counter >=2){
					_group_cards_.push(_cards_)
				}
				var _sum_chk = false
				if(_group_cards_.length >= 2){
					_group_cards_.forEach(function(e){
						if(e.length == 3){
							/* if greather then 3 its four of a kind and
							 it will be checked by another one before execution of this function*/
							_sum_chk = true
						}
					})
				}
				return {
					condition : _sum_chk,
					cards : (_sum_chk ? _group_cards_ : [])
				}
			},
			flush: function(cards){
				// print('flush...')
				cards.sort(SortBy.suit)
				var counter = 1, _cards_ = [cards[0]]
				
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].suit.id == cards[index + 1].suit.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1])
						/*Increment counter*/
						counter ++
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter >= 5){
						/* flush detected */
						return {
							condition: true,
							cards: _cards_
						}
					}
				}
				return {
					condition: false,
					cards: []
				}
			},
			straight: function(cards){
				// print('straight...')
				cards.sort(SortBy.rank)
				var counter = 1, _cards_ = [cards[0]]
				/*

					one has value only 1 vhich menas 10 jack queen king and one isnt flush
					this one should be fixed :((((((()))))))

				*/
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index + 1].rank.id == parseInt(cards[index].rank.id + 1)){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1])
						/*Increment counter*/
						counter ++
					}else if(cards[index].rank.id == cards[index + 1].rank.id){
						continue
					}else if(cards[0].rank.id == 1 && cards[index].rank.id == 13){ 
						/* one is added after King*/
						counter  ++
						_cards_.push(cards[0])
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter == 5){
						/*Four of a Kind detected*/
						return {
							condition : true,
							cards : _cards_
						}
					}
				}
				return {
					condition : false,
					cards : []
				}
			},
			threeofAkind: function(cards){
				// print('threeofAkind...')
				cards.sort(SortBy.rank)
				var counter = 1, _cards_ = [cards[0]]
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].rank.id == cards[index + 1].rank.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1]) // same here coment is down
						/*Increment counter*/
						counter ++
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter >= 3){
						/*Three of a Kind detected*/
						return {
							condition : true,
							cards : _cards_
						}
					}
				}
				return {
					condition : false,
					cards : []
				}
			},
			twoPairs: function(cards){
				// print('twoPairs...')
				/*
					one{1} hearts{14} ♥
					one{1} diamonds{16} ♦
					two{2} diamonds{16} ♦
					six{6} spades{17} ♠
					six{6} diamonds{16} ♦
					nine{9} hearts{14} ♥
					nine{9} spades{17} ♠
				*/
				cards.sort(SortBy.rank)
				var counter = 1, _cards_ = [cards[0]], _group_cards_ = new Array()
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].rank.id == cards[index + 1].rank.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1])
						/*Increment counter*/
						counter ++
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter >= 2){
						/* if 2 or more pair of ranks detected then add it to _group_cards_ array */
						_group_cards_.push(_cards_)
						counter = 1
						_cards_ = [cards[index + 1]]
					}
				}
				/* check again if last element makes pair*/
				if(counter >=2){
					_group_cards_.push(_cards_)
				}
				var _sum_chk = (_group_cards_.length >= 2 ? true : false)
				return {
					condition : _sum_chk,
					cards : (_sum_chk ? _group_cards_ : [])
				}
			},
			pair: function(cards){
				// print('pair...')
				cards.sort(SortBy.rank)
				var counter = 1, _cards_ = [cards[0]]
				for(var index = 0; len = cards.length, index < len - 1; index ++){
					if(cards[index].rank.id == cards[index + 1].rank.id){
						/*add card into _cards_ Array*/
						_cards_.push(cards[index + 1])
						/*Increment counter*/
						counter ++
					}else{
						counter = 1
						_cards_ = [cards[index + 1]]
					}
					if(counter >= 2){
						return {
							condition : true,
							cards : _cards_
						}
					}
				}
				
				return {
					condition : false,
					cards : []
				}
			},
			highCard: function(cards){
				// print('highCard...')
				cards.sort(SortBy.rank)
				var hcrd = cards[cards.length - 1]
				cards.forEach(function(e){
					if(e.rank.id == 1){
						hcrd = e
					}
				})
				return {
					condition:  true,
					cards: hcrd
				}
			}
		}
	}

	 
	function Game(){
		/*Here are all cards from 1 to King (all suits) count = 52 from 0 to 51*/
		this.distributing = 1
		this.playerFold = false
		this.pcFold = false
		this.deck = new Deck()
		this.player = {
			cards: [],
			money: 100
		}
		this.computer = {
			cards: [],
			money: 100
		}
		this.dealer = {
			cards: []
		}
		
		var rand = function(min, max) {
	    	return Math.floor(Math.random() * (max - min + 1) + min)
		}

		this.pick = function(){
			/*working perfect*/
			var remove = rand(0, this.deck.length - 1)
			var card = this.deck[remove]
			this.deck.splice(remove, 1)
			return card 
		}


		this.drawCard = function(pl, pc, dl){
			print('dealer')
			console.log(dl)
			document.getElementById('pc1').style.backgroundPositionX = '-'+pc[0].pixel.x+'px'
			document.getElementById('pc1').style.backgroundPositionY = '-'+pc[0].pixel.y+'px'
			document.getElementById('pc2').style.backgroundPositionX = '-'+pc[1].pixel.x+'px'
			document.getElementById('pc2').style.backgroundPositionY = '-'+pc[1].pixel.y+'px'


		if(dl.length==3){

			document.getElementById('dl1').style.backgroundPositionX = '-'+dl[0].pixel.x+'px'
			document.getElementById('dl1').style.backgroundPositionY = '-'+dl[0].pixel.y+'px'
			document.getElementById('dl2').style.backgroundPositionX = '-'+dl[1].pixel.x+'px'
			document.getElementById('dl2').style.backgroundPositionY = '-'+dl[1].pixel.y+'px'
			document.getElementById('dl3').style.backgroundPositionX = '-'+dl[2].pixel.x+'px'
			document.getElementById('dl3').style.backgroundPositionY = '-'+dl[2].pixel.y+'px'
		}else if(dl.length==4){

			document.getElementById('dl4').style.backgroundPositionX = '-'+dl[3].pixel.x+'px'
			document.getElementById('dl4').style.backgroundPositionY = '-'+dl[3].pixel.y+'px'
		}else if(dl.length==5){
			document.getElementById('dl5').style.backgroundPositionX = '-'+dl[4].pixel.x+'px'
			document.getElementById('dl5').style.backgroundPositionY = '-'+dl[4].pixel.y+'px'
		}

			document.getElementById('pl1').style.backgroundPositionX = '-'+pl[0].pixel.x+'px'
			document.getElementById('pl1').style.backgroundPositionY = '-'+pl[0].pixel.y+'px'
			document.getElementById('pl2').style.backgroundPositionX = '-'+pl[1].pixel.x+'px'
			document.getElementById('pl2').style.backgroundPositionY = '-'+pl[1].pixel.y+'px'

		}

		this.init = function(){
			this.generate()
			this.event()
			this.loop()
		}

		this.event = function(){
			var self = this
			this.checkBtn = document.getElementById('check')
			this.alertBox = document.getElementById('alert')
			this.pcMoneyBox = document.getElementById('pcMoney')
			this.plMoneyBox = document.getElementById('plMoney')
			this.foldBtn = document.getElementById('fold')
			this.betBtn = document.getElementById('bet')
			this.checkBtn.addEventListener('click', function(){
				self.distributing<5?self.distributing++:null
				self.loop()
			})

			this.foldBtn.addEventListener('click', function(){
				self.playerFold = true
				self.loop()
			})
		}

		this.generate = function(){
			var self = this; 
			([1, 2]).forEach(function(){
				self.player.cards.push(self.pick())
			});
			([1, 2]).forEach(function(){
				self.computer.cards.push(self.pick())
			});
			([1, 2, 3, 4, 5]).forEach(function(){
				self.dealer.cards.push(self.pick())
			});
			// this.player.cards = [this.pick(), this.pick()]
			// this.computer.cards = [this.pick(), this.pick()]
			// this.dealer.cards = [this.pick(), this.pick(), this.pick(), this.pick(), this.pick()]
		}
	 	
		this.checking = function(cards){
			cards.sort(SortBy.rank)

			cards.forEach(function(e){
				print(e.rank.name+'{'+e.rank.id+'} '+e.suit.name+'{'+e.suit.id+'} '+ e.suit.symbol)
			})

			var isFlush = new Is().flush(cards)
			var isStraight = new Is().straight(cards)

			/*checking straightFlush*/
			if(isFlush.condition && isStraight.condition){
				print('straightFlush', 'red', 24)
				print(isStraight.cards)
				isStraight.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 9,
					name : 'straight-flush',
					cards : isStraight.cards
				}
			}


			/* checking 4ofAkind */
			var is4aKing = new Is().fourOfAKind(cards)
			if(is4aKing.condition){
				print('4 of a kind', 'red', 24)
				print(is4aKing.cards)
				is4aKing.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 8,
					name : 'four of a kind',
					cards : is4aKing.cards
				}
			}

			/* checking full house*/
			var isFHouse = new Is().fullHouse(cards)
			if(isFHouse.condition){
				print('fullHouse', 'red', 24)
				isFHouse.cards.forEach(function(e){
					e.forEach(function(_e_){
						print(_e_.rank.name + ' ' + _e_.suit.name)
					})
				})
				return {
					id: 7,
					name : 'full house',
					cards : isFHouse.cards
				}
			}

			/*checking flush*/
			if(isFlush.condition){
				print('flush', 'red', 24)
				isFlush.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 6,
					name : 'flush',
					cards : isFlush.cards
				}
			}

			/* checking straight*/
			if(isStraight.condition){
				print('straight', 'red', 24)
				isStraight.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 5,
					name : 'straight',
					cards : isStraight.cards
				}
			}

			/* checking 3 of a kind*/
			var isthreeofAkind = new Is().threeofAkind(cards)
			if(isthreeofAkind.condition){
				print('3 of a kind', 'red', 24)
				isthreeofAkind.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 4,
					name : 'three of a kind',
					cards : isthreeofAkind.cards
				}
			}

			/* checking 2 pair*/
			var istwoPairs = new Is().twoPairs(cards)
			if(istwoPairs.condition){
				print('two pair', 'red', 24)
				istwoPairs.cards.forEach(function(e){
					e.forEach(function(_e_){
						print(_e_.rank.name + ' ' + _e_.suit.name)
					})
				})
				return {
					id: 3,
					name : 'tow pair',
					cards : istwoPairs.cards
				}
			}

			/* checking pair*/
			var isPair = new Is().pair(cards)
			if(isPair.condition){
				print(' pair', 'red', 24)
				isPair.cards.forEach(function(e){
					print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 2,
					name : 'one pair',
					cards : isPair.cards
				}
			}

			/* hight card*/
			var highCard = new Is().highCard(cards)
			if(highCard.condition){
				print('high card', 'red', 24)
				cards.forEach(function(e){
					if(e.rank.id == highCard.cards.rank.id)
						print('^ '+e.rank.name + ' ' + e.suit.name, 'green')
					else
						print(e.rank.name + ' ' + e.suit.name)
				})
				return {
					id: 1,
					name : 'high card',
					cards : highCard.cards
				}
			}
		}

		/* check player Cards*/
		this.loop = function(){
			this.pcMoneyBox.innerHTML = this.computer.money
			this.plMoneyBox.innerHTML = this.player.money




			var cardsPL = new Array(), cardsPC = new Array(), concatPC = [], concatPL = []
			cardsPL = this.player.cards
			cardsPC = this.computer.cards
			// console.log(cardsPC)
			this.drawCard(cardsPL, cardsPC, concatPL)

			if(this.distributing == 2){
				for(var index = 0; index <= 2; index ++){
					/*distribute 3 cards*/
					concatPL.push(this.dealer.cards[index]) 
					concatPC.push(this.dealer.cards[index]) 

				}
				this.drawCard(cardsPL, cardsPC, concatPL)
			}
			if(this.distributing == 3){
				/*distribute 4 cards*/
				for(var index = 0; index <= 3; index ++){
					concatPL.push(this.dealer.cards[index]) 
					concatPC.push(this.dealer.cards[index]) 
				}
				this.drawCard(cardsPL, cardsPC, concatPL)
			}
			if(this.distributing == 4){
				/*distribute 5 cards*/
				for(var index = 0; index <= 4; index ++){
					concatPL.push(this.dealer.cards[index]) 
					concatPC.push(this.dealer.cards[index]) 
				}
				this.drawCard(cardsPL, cardsPC, concatPL)
			}

			cardsPL = cardsPL.concat(concatPL)
			cardsPC = cardsPC.concat(concatPC)
			// var cardsPL = this.player.cards.concat(this.dealer.cards)
			// var cardsPC = this.computer.cards.concat(this.dealer.cards)
			
			/*player cards cheking*/
			print("PLAYER cards",'rgba(255,0,0,0.6)', 20)
			var PL = this.checking(cardsPL)
			print('----------------------------------------------------------------','yellow', 24)
			/*computer cards checking*/
			print("COMPUTER cards",'rgba(0,255,0,0.6)', 20)
			var PC = this.checking(cardsPC)

			if(this.playerFold){
				this.alertBox.innerHTML= "PC wins"
				this.player.money -= 10
				return
			}
			if(PL.id == PC.id){
				if(typeof PL.cards.rank === 'object'){ 
					/*
						if there is only one object and not an Array
						its for only high card
					*/
					if(PL.cards.rank.id == PC.cards.rank.id){
						print('DRAWN','blue', 56)
					}else if(PL.cards.rank.id == 1){
						print('Player Wins','green', 56)
					}else if(PL.cards.rank.id > PC.cards.rank.id){
						print('Player Wins','green', 56)
					}else{
						print('Computer Wins','red', 56)
					}
				}else{
					print('DRAWN','blue', 56)
				}
			}else if(PL.id < PC.id){
				print('Computer Wins','red', 56)
			}else{
				print('Player Wins','green', 56)
			}
			
		}
	}
	
	
	new Game().init()
	// new Game().drawCard()

})(window, document)



 
 
</script>
</body>
</html>